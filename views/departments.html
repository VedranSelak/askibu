
<div id="page-wrapper">
  <div class="container-fluid">
    <div class="row">
        <div class="col-lg-12">
            <h1 id="title" class="page-header">Questions</h1>
        </div>
    </div>
    <div id="question-list" class="row">
      <div class="col-lg-12">
        <div class="card bg-info card-padding card-style" style="height: 15rem;">
          <div class="card-body">
            <h3 class="card-title">Card title</h3>
            <h6 class="card-subtitle mb-2 text-muted">Card subtitle</h6>
            <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
            <a href="#" class="card-link">Card link</a>
            <a href="#" class="card-link">Another link</a>
          </div>
        </div>
      </div>
      <div class="col-lg-12">
        <div class="card bg-info card-padding card-style" style="height: 15rem;">
          <div class="card-body">
            <h3 class="card-title">Card title</h3>
            <h6 class="card-subtitle mb-2 text-muted">Card subtitle</h6>
            <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
            <a href="#" class="card-link">Card link</a>
            <a href="#" class="card-link">Another link</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  $(window).on('hashchange', function(e){
    loadPage();
  });

  function loadPage(){
    let query = window.location.search;
    const urlParams = new URLSearchParams(query);
    let department = urlParams.get("department");

    $.ajax({
         url: "api/user/departments/"+department,
         type: "GET",
         beforeSend: function(xhr){xhr.setRequestHeader('Authentication', localStorage.getItem("token"));},
         success: function(data) {
           $("#title").html(data.name);
           console.log(data);
         },
         error: function(jqXHR, textStatus, errorThrown ){
           toastr.error(jqXHR.responseJSON.message);
           console.log(jqXHR);
         }
      });

      $.ajax({
           url: "api/user/question-by-department/"+department,
           type: "GET",
           beforeSend: function(xhr){xhr.setRequestHeader('Authentication', localStorage.getItem("token"));},
           success: function(data) {
             console.log(data);
             var text = "";
             for(var i=0; i<data.length; i++){
               text += "<div class='col-lg-12'><div class='card bg-info card-padding card-style' style='height: 15rem;'><div class='card-body'><h3 class='card-title'>"+data[i].subject+"</h3><h6 class='card-subtitle mb-2 text-muted'>"+data[i].posted_at+"</h6><h6 class='card-subtitle mb-2 text-muted'>Posted by: "+data[i].name+"</h6><p class='card-text'>"+data[i].body+"</p></div></div></div>";
             }

             $('#question-list').html(text);
           },
           error: function(jqXHR, textStatus, errorThrown ){
             toastr.error(jqXHR.responseJSON.message);
             console.log(jqXHR);
           }
        });

  }
  $(document).ready(function() {
    loadPage();
  });
</script>
